<!DOCTYPE html><html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vlife – Hybrid VR (Dynamic Menu + Hotspots)</title>
  <link rel="icon" href="assets/Vlifelogo_1_.png" />
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    :root { --gold:#ffd700; --bg:#0b0b0f; --text:#e7e7ea; }
    body { margin:0; background:#000; font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial; }/* Brand */
.topright { position:fixed; right:16px; top:12px; display:flex; align-items:center; gap:10px; z-index:9; }
.brandimg { width:32px; height:32px; object-fit:contain; border-radius:8px; background:#000; box-shadow:0 0 0 1px rgba(255,255,255,.25) inset; }
.brand { color:var(--gold); font-weight:800; letter-spacing:.6px; text-shadow:0 0 12px rgba(255,215,0,.4); }

/* Menu */
.menu { position:fixed; inset:0; background:rgba(0,0,0,0.9); display:flex; flex-direction:column; align-items:center; justify-content:center; gap:16px; color:var(--text); z-index:10; }
.menu h1 { color:var(--gold); margin:6px 0; }
.menu h3 { margin:10px 0 4px; opacity:.9; }
.menu .row { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; max-width:900px; }
.menu button { background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.2); color:var(--text); padding:10px 16px; border-radius:12px; font-size:15px; cursor:pointer; min-width:220px; }
.menu button:hover { border-color:var(--gold); color:var(--gold); }

/* Controls */
.backBtn { position:fixed; top:14px; left:14px; background:rgba(0,0,0,.6); border:1px solid rgba(255,255,255,.2); color:#fff; border-radius:10px; padding:8px 12px; cursor:pointer; z-index:9; display:none; }
.hud { position:fixed; inset:auto 16px 16px 16px; display:flex; gap:12px; justify-content:center; flex-wrap:wrap; z-index:9; }
.btn { border:1px solid rgba(255,255,255,.2); background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.02)); color:var(--text); padding:9px 12px; border-radius:12px; font-weight:600; cursor:pointer; backdrop-filter:blur(6px); }
.btn:hover{ border-color:var(--gold); color:var(--gold);}    
.badge { position:fixed; bottom:12px; left:12px; color:#9ea0aa; font-size:12px; opacity:.85; z-index:9; }

/* In‑scene labels */
.panel { position:fixed; left:50%; bottom:22px; transform:translateX(-50%); background:rgba(10,10,14,.8); color:#fff; padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.15); max-width:min(680px,90vw); display:none; z-index:9; }
  /* How-it-works modal */
.howOverlay{position:fixed;inset:0;background:rgba(0,0,0,.92);display:none;align-items:center;justify-content:center;z-index:20}
.howBox{width:min(820px,92vw);max-height:86vh;overflow:auto;background:rgba(16,16,22,.9);border:1px solid rgba(255,255,255,.18);border-radius:16px;color:#e7e7ea;padding:20px 22px;box-shadow:0 24px 120px rgba(0,0,0,.6)}
.howBox h2{margin:0 0 8px;color:var(--gold)}
.howBox ol{margin:8px 0 0 18px}
.howClose{position:absolute;top:14px;right:14px;background:rgba(0,0,0,.6);border:1px solid rgba(255,255,255,.2);color:#fff;border-radius:10px;padding:8px 12px;cursor:pointer}

  </style>
</head>
<body>
  <div class="topright">
    <img class="brandimg" src="assets/Vlifelogo_1_.png" alt="V LIFE" />
    <div class="brand">VLIFE</div>
  </div>  <div class="menu" id="menu">
    <img src="assets/Vlifelogo_1_.png" style="width:140px;height:auto;filter:drop-shadow(0 0 15px rgba(255,215,0,.2));">
    <h1>Select Experience</h1>
    <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center">
      <button id="startBtn">Start Tour ▶</button>
      <button id="howBtn">How it works</button>
    </div>
    <div id="videoGroup" class="row"></div>
    <div id="photoGroup" class="row"></div>
  </div>  <!-- How it works overlay -->  <div class="howOverlay" id="howOverlay">
    <div class="howBox">
      <button class="howClose" id="howClose">✕ Close</button>
      <h2>How it works</h2>
      <ol>
        <li><strong>Pick a scene</strong> from the menu (photo, local video, or YouTube 360).</li>
        <li>The scene opens in an immersive sphere. <strong>Look around</strong> by moving your phone/dragging.</li>
        <li><strong>Gold orbs</strong> are interactive hotspots: tap/gaze to show info or jump to another scene.</li>
        <li>Yellow guide orbs are placed evenly around you to mark a <strong>full 360° ring</strong> for orientation.</li>
        <li><strong>Back to Menu</strong> returns you to the list. Works on desktop, mobile, and Quest browser.</li>
      </ol>
    </div>
  </div><button id="backBtn" class="backBtn">← Back to Menu</button>

  <div class="hud">
    <button class="btn" id="playBtn">▶ Play</button>
    <button class="btn" id="pauseBtn">⏸ Pause</button>
    <button class="btn" id="rewindBtn">↺ 0:00</button>
    <button class="btn" id="midBtn">⇥ 0:30</button>
  </div>
  <div class="badge">Vlife VR · Dynamic Menu + Hotspots</div>
  <div class="panel" id="infoPanel"></div>  <a-scene id="scene" renderer="alpha:true antialias:true" background="color:#000">
    <a-assets id="assetsContainer" timeout="30000"></a-assets><a-entity id="rig">
  <a-entity camera look-controls position="0 1.6 0">
    <a-entity cursor="fuse:true; fuseTimeout:900" position="0 0 -1" geometry="primitive:ring; radiusInner:0.01; radiusOuter:0.015" material="shader:flat; color:#ffd700; opacity:0.9"></a-entity>
  </a-entity>
</a-entity>

<a-videosphere id="videoSphere" visible="false" rotation="0 -90 0"></a-videosphere>
<a-sky id="photoSky" visible="false" rotation="0 -90 0"></a-sky>

<!-- Hotspot holder -->
<a-entity id="hotspots"></a-entity>

<!-- Decorative / guide ring of yellow orbs -->
<a-entity id="ringOrbs"></a-entity>

<a-entity light="type:ambient; intensity:0.4"></a-entity>

  </a-scene>  <script>
    // ===== Helpers =====
    const menu = document.getElementById('menu');
    const videoSphere = document.getElementById('videoSphere');
    const photoSky = document.getElementById('photoSky');
    const backBtn = document.getElementById('backBtn');
    const assetsContainer = document.getElementById('assetsContainer');
    const infoPanel = document.getElementById('infoPanel');
    const hotspotsRoot = document.getElementById('hotspots');
    const ringRoot = document.getElementById('ringOrbs');

    const deg2rad = (d)=> d * Math.PI / 180;
    // Convert yaw (0 forward, +right), pitch (+up) and radius to XYZ in A-Frame (forward is -Z)
    function posFromYawPitchR(yaw, pitch, r){
      const yR = deg2rad(yaw), pR = deg2rad(pitch);
      const x = r * Math.sin(yR) * Math.cos(pR);
      const y = r * Math.sin(pR);
      const z = -r * Math.cos(yR) * Math.cos(pR);
      return `${x.toFixed(3)} ${y.toFixed(3)} ${z.toFixed(3)}`;
    }

    let MEDIA = { videos: [], photos: [] };

    // ===== Build Menu from media.json =====
    async function loadMenu(){
      const res = await fetch('assets/media.json');
      MEDIA = await res.json();

      const vGroup = document.getElementById('videoGroup');
      const pGroup = document.getElementById('photoGroup');

      if (MEDIA.videos?.length){
        const h = document.createElement('h3'); h.textContent = 'Videos'; vGroup.before(h);
        MEDIA.videos.forEach((v,i)=>{
          const b=document.createElement('button');
          const title = v.title || `Video ${i+1}`;
          if (v.youtubeId) { b.innerHTML = title + ' · <small>YouTube</small>'; }
          else { b.textContent = title; }
          b.onclick=()=>playMedia('video', v);
          vGroup.appendChild(b);
        });
      }
      if (MEDIA.photos?.length){
        const h = document.createElement('h3'); h.textContent = 'Photos'; pGroup.before(h);
        MEDIA.photos.forEach((p,i)=>{
          const b=document.createElement('button'); b.textContent=p.title||`Photo ${i+1}`; b.onclick=()=>playMedia('photo', p); pGroup.appendChild(b);
        });
      }
    }

    // ===== Scene control =====
    async function playMedia(type, item){
      // If this is a YouTube item, open in a new tab (best for Quest/phones) and keep menu
      if (type==='video' && item.youtubeId){
        const id = item.youtubeId.trim();
        const url = `https://www.youtube.com/watch?v=${id}&vr=1`;
        window.open(url, '_blank');
        return; // do not hide menu / alter scene
      }

      clearHotspots();
      infoPanel.style.display='none';
      menu.style.display='none';
      backBtn.style.display='block';

      if (type==='video'){
        // create/replace dynamic video element
        let vid = document.getElementById('dynamicVideo');
        if (vid) { try{vid.pause();}catch{} vid.remove(); }
        vid = document.createElement('video');
        vid.id='dynamicVideo';
        vid.src = `assets/${item.file}`;
        vid.setAttribute('crossorigin','anonymous');
        vid.setAttribute('playsinline','');
        vid.setAttribute('webkit-playsinline','');
        vid.setAttribute('muted','');
        vid.setAttribute('loop','');
        assetsContainer.appendChild(vid);
        try{ await vid.play(); }catch(e){ console.warn('Autoplay blocked', e); }
        videoSphere.setAttribute('src','#dynamicVideo');
        videoSphere.setAttribute('visible', true);
        photoSky.setAttribute('visible', false);
        attachHotspots(item.hotspots || defaultHotspots());
        attachRingOrbs(24, 0, 2.7);
      }
      if (type==='photo'){
        photoSky.setAttribute('src', `assets/${item.file}`);
        photoSky.setAttribute('visible', true);
        videoSphere.setAttribute('visible', false);
        attachHotspots(item.hotspots || defaultHotspots());
        attachRingOrbs(24, 0, 2.7);
      }
    }

    function backToMenu(){
      clearHotspots();
      const vid = document.getElementById('dynamicVideo');
      if (vid){ try{vid.pause();}catch{} vid.remove(); }
      videoSphere.setAttribute('visible', false);
      photoSky.setAttribute('visible', false);
      backBtn.style.display='none';
      infoPanel.style.display='none';
      menu.style.display='flex';
    }

    backBtn.onclick = backToMenu;

    // ===== Hotspots =====
    function attachHotspots(hotspots){
      hotspots.forEach(h => {
        const orb = document.createElement('a-entity');
        orb.setAttribute('geometry','primitive:sphere; radius:0.28');
        orb.setAttribute('material','color:#ffd700; opacity:0.92; emissive:#6f5a00; emissiveIntensity:0.25');
        const pos = posFromYawPitchR(h.yaw||0, h.pitch||0, h.radius||2.5);
        orb.setAttribute('position', pos);
        orb.classList.add('hotspot');
        orb.addEventListener('click', ()=> handleHotspot(h));
        hotspotsRoot.appendChild(orb);
      });
    }

    function clearHotspots(){
      while (hotspotsRoot.firstChild) hotspotsRoot.removeChild(hotspotsRoot.firstChild);
      while (ringRoot.firstChild) ringRoot.removeChild(ringRoot.firstChild);
    }

    function handleHotspot(h){
      if (h.type==='info'){
        infoPanel.innerText = h.text || 'Info';
        infoPanel.style.display='block';
        if (h.autoHide){ setTimeout(()=> infoPanel.style.display='none', h.autoHide); }
      } else if (h.type==='link'){
        // find target by id or filename in MEDIA
        const target = findMediaById(h.target) || findMediaByFile(h.target);
        if (target){ playMedia(target.kind, target.item); }
      } else if (h.type==='url'){
        window.open(h.href, '_blank');
      }
    }

    function findMediaById(id){
      const v = MEDIA.videos?.find(x=>x.id===id); if (v) return {kind:'video', item:v};
      const p = MEDIA.photos?.find(x=>x.id===id); if (p) return {kind:'photo', item:p};
      return null;
    }
    function findMediaByFile(file){
      const v = MEDIA.videos?.find(x=>x.file===file); if (v) return {kind:'video', item:v};
      const p = MEDIA.photos?.find(x=>x.file===file); if (p) return {kind:'photo', item:p};
      return null;
    }

    function defaultHotspots(){
      return [
        { type:'info', text:'Welcome to Vlife — tap or gaze on gold orbs for info and navigation.', yaw:0, pitch:-10, radius:2.2, autoHide:4000 }
      ];
    }

    // Create an evenly spaced ring of yellow orbs around the viewer
    function attachRingOrbs(count=24, pitch=0, radius=2.7){
      for (let i=0;i<count;i++){
        const yaw = i * (360 / count);
        const orb = document.createElement('a-entity');
        orb.setAttribute('geometry','primitive:sphere; radius:0.12');
        orb.setAttribute('material','color:#ffd700; opacity:0.85; emissive:#6f5a00; emissiveIntensity:0.35');
        orb.setAttribute('position', posFromYawPitchR(yaw, pitch, radius));
        ringRoot.appendChild(orb);
      }
    }
      ];
    }

    // HUD controls
    document.getElementById('playBtn').onclick = ()=>{
      const v=document.getElementById('dynamicVideo'); if (v) v.play(); };
    document.getElementById('pauseBtn').onclick = ()=>{
      const v=document.getElementById('dynamicVideo'); if (v) v.pause(); };
    document.getElementById('rewindBtn').onclick = ()=>{
      const v=document.getElementById('dynamicVideo'); if (v){ v.currentTime=0; v.play(); }};
    document.getElementById('midBtn').onclick = ()=>{
      const v=document.getElementById('dynamicVideo'); if (v){ v.currentTime=30; v.play(); }};

    function wireStartButton(){
      const btn = document.getElementById('startBtn');
      if (!btn) return;
      if (MEDIA.photos && MEDIA.photos.length){
        btn.style.display = 'inline-block';
        btn.onclick = ()=> playMedia('photo', MEDIA.photos[0]);
      } else if (MEDIA.videos && MEDIA.videos.length){
        btn.style.display = 'inline-block';
        btn.onclick = ()=> playMedia('video', MEDIA.videos[0]);
      } else {
        btn.style.display = 'none';
      }
    }

    loadMenu();
    // After menu loads, enable Start Tour
    setTimeout(wireStartButton, 50);

    // How it works modal wiring
    const howBtn = document.getElementById('howBtn');
    const howOverlay = document.getElementById('howOverlay');
    const howClose = document.getElementById('howClose');
    if (howBtn){ howBtn.addEventListener('click', ()=> howOverlay.style.display='flex'); }
    if (howClose){ howClose.addEventListener('click', ()=> howOverlay.style.display='none'); }

    // Tip: To add a YouTube video, put an entry in assets/media.json like:
    // { "title": "My VR Clip", "youtubeId": "VIDEO_ID_HERE" }
  </script></body>
</html>