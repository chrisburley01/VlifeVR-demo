<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vlife – Hybrid VR (Dynamic Menu)</title>
  <link rel="icon" href="assets/Vlifelogo_1_.png" />
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    :root { --gold:#ffd700; --bg:#0b0b0f; --text:#e7e7ea; }
    body { margin:0; background:#000; font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial; }

    .topright { position:fixed; right:16px; top:12px; display:flex; align-items:center; gap:10px; z-index:9;}
    .brandimg { width:32px; height:32px; object-fit:contain; border-radius:8px; background:#000;
                box-shadow:0 0 0 1px rgba(255,255,255,.25) inset;}
    .brand { color:var(--gold); font-weight:800; letter-spacing:.6px; text-shadow:0 0 12px rgba(255,215,0,.4);}

    .menu { position:fixed; inset:0; background:rgba(0,0,0,0.9); display:flex; flex-direction:column;
            align-items:center; justify-content:center; gap:20px; color:var(--text); z-index:10; }
    .menu h1 { color:var(--gold); margin-bottom:10px; }
    .menu button { background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.2); color:var(--text);
                   padding:10px 16px; border-radius:12px; font-size:16px; cursor:pointer; width:220px; }
    .menu button:hover { border-color:var(--gold); color:var(--gold); }

    .backBtn { position:fixed; top:14px; left:14px; background:rgba(0,0,0,.6); border:1px solid rgba(255,255,255,.2);
               color:#fff; border-radius:10px; padding:8px 12px; cursor:pointer; z-index:9; display:none; }

    .badge { position:fixed; bottom:12px; left:12px; color:#9ea0aa; font-size:12px; opacity:.85; z-index:9; }
  </style>
</head>
<body>
  <div class="topright">
    <img class="brandimg" src="assets/Vlifelogo_1_.png" alt="V LIFE" />
    <div class="brand">VLIFE</div>
  </div>

  <div class="menu" id="menu">
    <img src="assets/Vlifelogo_1_.png" style="width:140px;height:auto;filter:drop-shadow(0 0 15px rgba(255,215,0,.2));">
    <h1>Select Experience</h1>
    <div id="videoButtons"></div>
    <div id="photoButtons"></div>
  </div>

  <button id="backBtn" class="backBtn">← Back to Menu</button>
  <div class="badge">Hybrid VR Dynamic Menu · Vlife 2025</div>

  <a-scene id="scene" renderer="alpha:true antialias:true" background="color:#000">
    <a-assets id="assetsContainer" timeout="30000"></a-assets>
    <a-entity id="rig">
      <a-entity camera look-controls position="0 1.6 0">
        <a-entity cursor="fuse:true; fuseTimeout:900" position="0 0 -1"
          geometry="primitive:ring; radiusInner:0.01; radiusOuter:0.015"
          material="shader:flat; color:#ffd700; opacity:0.9"></a-entity>
      </a-entity>
    </a-entity>

    <a-videosphere id="videoSphere" visible="false" rotation="0 -90 0"></a-videosphere>
    <a-sky id="photoSky" visible="false" rotation="0 -90 0"></a-sky>
    <a-entity light="type:ambient; intensity:0.4"></a-entity>
  </a-scene>

  <script>
    const menu = document.getElementById('menu');
    const videoSphere = document.getElementById('videoSphere');
    const photoSky = document.getElementById('photoSky');
    const backBtn = document.getElementById('backBtn');
    const assetsContainer = document.getElementById('assetsContainer');

    async function loadMenu() {
      try {
        const res = await fetch('assets/media.json');
        const data = await res.json();

        // Videos
        const vDiv = document.getElementById('videoButtons');
        if (data.videos && data.videos.length > 0) {
          const vTitle = document.createElement('h3');
          vTitle.textContent = 'Videos';
          vDiv.appendChild(vTitle);
          data.videos.forEach(v => {
            const btn = document.createElement('button');
            btn.textContent = v.title;
            btn.onclick = () => playMedia('video', v.file);
            vDiv.appendChild(btn);
          });
        }

        // Photos
        const pDiv = document.getElementById('photoButtons');
        if (data.photos && data.photos.length > 0) {
          const pTitle = document.createElement('h3');
          pTitle.textContent = 'Photos';
          pDiv.appendChild(pTitle);
          data.photos.forEach(p => {
            const btn = document.createElement('button');
            btn.textContent = p.title;
            btn.onclick = () => playMedia('photo', p.file);
            pDiv.appendChild(btn);
          });
        }
      } catch (e) {
        console.error('Failed to load media.json', e);
      }
    }

    async function playMedia(type, file) {
      menu.style.display = 'none';
      backBtn.style.display = 'block';

      if (type === 'video') {
        const vid = document.createElement('video');
        vid.setAttribute('id', 'dynamicVideo');
        vid.setAttribute('src', `assets/${file}`);
        vid.setAttribute('crossorigin', 'anonymous');
        vid.setAttribute('playsinline', '');
        vid.setAttribute('webkit-playsinline', '');
        vid.setAttribute('muted', '');
        vid.setAttribute('loop', '');
        assetsContainer.appendChild(vid);
        await vid.play();
        videoSphere.setAttribute('src', '#dynamicVideo');
        videoSphere.setAttribute('visible', true);
        photoSky.setAttribute('visible', false);
      }

      if (type === 'photo') {
        photoSky.setAttribute('src', `assets/${file}`);
        photoSky.setAttribute('visible', true);
        videoSphere.setAttribute('visible', false);
      }
    }

    backBtn.onclick = () => {
      const vid = document.getElementById('dynamicVideo');
      if (vid) { vid.pause(); vid.remove(); }
      videoSphere.setAttribute('visible', false);
      photoSky.setAttribute('visible', false);
      menu.style.display = 'flex';
      backBtn.style.display = 'none';
    };

    loadMenu();
  </script>
</body>
</html>