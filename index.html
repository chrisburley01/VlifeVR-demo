<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vlife – Hybrid VR Experience</title>
  <link rel="icon" href="assets/Vlifelogo_1_.png" />
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-event-set-component@5.0.1/dist/aframe-event-set-component.min.js"></script>
  <style>
    :root { --gold:#ffd700; --text:#e7e7ea; }
    body { margin:0; background:#000; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; }

    /* Gate */
    .gate{position:fixed;inset:0;display:grid;place-items:center;
      background:radial-gradient(1200px 600px at 50% 100%,rgba(255,215,0,.06),rgba(0,0,0,.92));z-index:10;}
    .gate-inner{max-width:720px;margin:0 16px;background:rgba(12,12,18,.72);padding:22px;
      border:1px solid rgba(255,255,255,.15);border-radius:16px;text-align:center;color:var(--text);
      box-shadow:0 16px 72px rgba(0,0,0,.6);}
    .gate-logo{width:min(360px,70vw);height:auto;display:block;margin:0 auto 12px;
      filter:drop-shadow(0 8px 24px rgba(255,215,0,.25));animation:pulse 5s ease-in-out infinite;}
    @keyframes pulse{0%,100%{filter:drop-shadow(0 0 15px rgba(255,215,0,.3));}
      50%{filter:drop-shadow(0 0 35px rgba(255,215,0,.7));}}
    .btn-primary{background:linear-gradient(180deg,#ffe58a,#e7c138);color:#2b2500;border:none;
      border-radius:12px;padding:10px 18px;font-weight:600;cursor:pointer;}
    .btn-primary:hover{filter:brightness(1.15);}

    /* Brand */
    .topright{position:fixed;right:16px;top:12px;display:flex;align-items:center;gap:10px;z-index:9;}
    .brandimg{width:32px;height:32px;object-fit:contain;border-radius:8px;background:#000;
      box-shadow:0 0 0 1px rgba(255,255,255,.25) inset;}
    .brand{color:var(--gold);font-weight:800;letter-spacing:.6px;text-shadow:0 0 12px rgba(255,215,0,.4);}
    .badge{position:fixed;top:12px;left:12px;color:#bdbdc7;font-size:12px;background:rgba(0,0,0,.45);
      padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.1);z-index:9;}
  </style>
</head>
<body>
  <!-- Branding -->
  <div class="topright">
    <img class="brandimg" src="assets/Vlifelogo_1_.png" alt="V LIFE" />
    <div class="brand">VLIFE</div>
  </div>
  <div class="badge">Hybrid VR MVP · 360° Links</div>

  <!-- Entry -->
  <div class="gate" id="gate">
    <div class="gate-inner">
      <img class="gate-logo" src="assets/Vlifelogo_1_.png" alt="V LIFE logo" />
      <h1>Enter Vlife</h1>
      <p>Immersive 360° exploration.<br>Desktop, mobile & Meta Quest compatible.</p>
      <button class="btn-primary" id="enterBtn">Enter Experience</button>
      <p style="margin-top:10px;font-size:12px;opacity:.8;">Look around and click gold orbs to open 360° video sites.</p>
    </div>
  </div>

  <!-- Scene -->
  <a-scene renderer="alpha:true antialias:true" background="color:#000">
    <!-- Camera rig -->
    <a-entity id="rig">
      <a-entity id="camera" camera wasd-controls-enabled="false" look-controls position="0 1.6 0"
                cursor="fuse:true; fuseTimeout:900"
                raycaster="objects: .clickable">
        <a-entity position="0 0 -1"
          geometry="primitive:ring; radiusInner:0.01; radiusOuter:0.015"
          material="shader:flat; opacity:0.9"></a-entity>

        <!-- Look-down Reset Orb (appears after 3s of looking down) -->
        <a-entity id="resetGroup" position="0 -0.9 -0.7" visible="false">
          <a-entity id="resetOrb" class="clickable"
            geometry="primitive:sphere; radius:0.18"
            material="color:#ffd700; emissive:#ffd700; emissiveIntensity:0.6; opacity:0.95"
            animation__glow="property=material.emissiveIntensity; dir=alternate; dur=1600; from:0.4; to:1; loop:true">
          </a-entity>
          <a-entity id="resetLabel" position="0 0.34 0"
            billboard-label
            text="value:Reset / Refresh; align:center; width:2.6; color:#ffd700; side:double">
          </a-entity>
        </a-entity>
      </a-entity>
    </a-entity>

    <!-- Sky, orbs and in-scene SKINS panel -->
    <a-entity id="photoScene">
      <a-sky id="sky" color="#0b0d13"></a-sky>

      <!-- In-scene Panel with 6 skin buttons -->
      <a-entity id="skinPanel" position="0 1.55 -2" visible="false">
        <a-entity geometry="primitive:plane; width:2.2; height:1.1"
                  material="color:#10131a; opacity:0.92"></a-entity>
        <a-entity position="0 0.44 0.01"
          text="value:Choose Background Skin; align:center; width:3; color:#ffd700"></a-entity>

        <!-- Buttons grid: 3 x 2 -->
        <!-- Row 1 -->
        <a-entity id="btn0" class="skinbtn clickable" position="-0.7 0.12 0.02"></a-entity>
        <a-entity id="btn1" class="skinbtn clickable" position="0 0.12 0.02"></a-entity>
        <a-entity id="btn2" class="skinbtn clickable" position="0.7 0.12 0.02"></a-entity>
        <!-- Row 2 -->
        <a-entity id="btn3" class="skinbtn clickable" position="-0.7 -0.28 0.02"></a-entity>
        <a-entity id="btn4" class="skinbtn clickable" position="0 -0.28 0.02"></a-entity>
        <a-entity id="btn5" class="skinbtn clickable" position="0.7 -0.28 0.02"></a-entity>
      </a-entity>

      <!-- ring of external links -->
      <a-entity id="orbRing"></a-entity>
    </a-entity>

    <a-entity id="keyLight" light="type:point; intensity:0.8; distance:12" position="0 3 0"></a-entity>
    <a-entity id="ambLight" light="type:ambient; intensity:0.4; color:#ffffff"></a-entity>
  </a-scene>

  <script>
    /* ---------- Components ---------- */

    // Robust billboard label (no mirroring / no disappearing in VR)
    AFRAME.registerComponent('billboard-label', {
      init: function () {
        this.cam = document.querySelector('#camera');
        this.tmp = new THREE.Vector3();
        this.flipQ = new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0), Math.PI);
      },
      tick: function () {
        if (!this.cam) return;
        const obj = this.el.object3D;
        const camPos = this.cam.object3D.getWorldPosition(this.tmp);
        obj.lookAt(camPos);
        obj.quaternion.multiplyQuaternions(obj.quaternion, this.flipQ); // constant Y flip
        obj.rotation.x = 0; obj.rotation.z = 0; // keep upright
      }
    });

    // Watch head tilt; after hold ms looking down, show the reset orb under the camera
    AFRAME.registerComponent('lookdown-reset', {
      schema: { hold: {type:'int', default:3000}, thresholdY: {type:'number', default:-0.6}},
      init: function () {
        this.cam = this.el; // attach to #camera
        this.dir = new THREE.Vector3();
        this.downMs = 0;
        this.last = null;
        this.resetGroup = document.querySelector('#resetGroup');
      },
      tick: function (t, dt) {
        if (!this.cam) return;
        const obj = this.cam.object3D;
        obj.getWorldDirection(this.dir); // forward vector
        const lookingDown = this.dir.y < this.data.thresholdY; // e.g. < -0.6 ~ 53°
        if (this.last == null) this.last = t;

        if (lookingDown) {
          this.downMs += dt;
          if (this.downMs >= this.data.hold) {
            this.resetGroup.setAttribute('visible', true);
          }
        } else {
          this.downMs = 0;
          // Hide if user looks away for a bit
          if (this.resetGroup.getAttribute('visible')) {
            // fade out after 1200ms of not looking down
            if (!this.hideAt) this.hideAt = t + 1200;
            if (t > this.hideAt) {
              this.resetGroup.setAttribute('visible', false);
              this.hideAt = null;
            }
          } else {
            this.hideAt = null;
          }
        }
      }
    });

    /* ---------- App logic ---------- */

    const $ = s => document.querySelector(s);
    const gate = $('#gate');
    const sky  = $('#sky');
    const keyLight = $('#keyLight');
    const ambLight = $('#ambLight');

    // 360° / VR links
    const links = [
      {title:'360Cities', url:'https://www.360cities.net/'},
      {title:'YouTube VR Channel', url:'https://m.youtube.com/channel/UCzuqhhs6NWbgTzMuM09WKDQ'},
      {title:'YouTube 360 Playlist', url:'https://www.youtube.com/playlist?list=PLU8wpH_LfhmtcxKMb1s46HUz8AVnLiY3O'},
      {title:'Vimeo 360', url:'https://vimeo.com/channels/360videos'},
      {title:'Meta Quest TV', url:'https://www.meta.com/quest/tv/'},
      {title:'AirPano', url:'https://www.airpano.com/'}
    ];

    // Background skins
    const skins = [
      { name:'Deep Night',   sky:'#0a0d14', ambient:'#9fbfff', ambInt:0.35, keyInt:0.8 },
      { name:'Blue Twilight',sky:'#0f1a2b', ambient:'#9ecbff', ambInt:0.42, keyInt:0.9 },
      { name:'Purple Nebula',sky:'#1a1024', ambient:'#ffccff', ambInt:0.45, keyInt:0.85 },
      { name:'Soft Dawn',    sky:'#2a3442', ambient:'#ffe4b5', ambInt:0.50, keyInt:0.75 },
      { name:'Graphite',     sky:'#111316', ambient:'#d0d0d0', ambInt:0.38, keyInt:0.9 },
      { name:'Teal Glow',    sky:'#0e2022', ambient:'#9ef6e2', ambInt:0.48, keyInt:0.8 }
    ];
    let skinIndex = 0;

    function applySkin(i){
      const s = skins[i % skins.length];
      skinIndex = i % skins.length;
      sky.setAttribute('color', s.sky);
      ambLight.setAttribute('light', `type:ambient; intensity:${s.ambInt}; color:${s.ambient}`);
      keyLight.setAttribute('light', `type:point; intensity:${s.keyInt}; distance:12; color:#ffffff`);
      highlightSkinButton(skinIndex);
    }

    // Build clickable skin buttons in panel
    function buildSkinPanel(){
      const ids = ['btn0','btn1','btn2','btn3','btn4','btn5'];
      ids.forEach((id, idx)=>{
        const slot = document.getElementById(id);
        slot.innerHTML = '';
        // button background
        const bg = document.createElement('a-entity');
        bg.setAttribute('geometry','primitive:plane; width:0.62; height:0.24;');
        bg.setAttribute('material','color:#161a22; opacity:0.95;');
        // label
        const label = document.createElement('a-entity');
        label.setAttribute('position','0 0 0.01');
        label.setAttribute('billboard-label','');
        label.setAttribute('text',`value:${skins[idx].name}; align:center; width:1.8; color:#dfe3ea; side:double`);
        // interactions
        slot.addEventListener('click',()=>applySkin(idx));
        slot.setAttribute('event-set__enter','_event:mouseenter; scale:1.07 1.07 1.07');
        slot.setAttribute('event-set__leave','_event:mouseleave; scale:1 1 1');
        // keep references
        slot.appendChild(bg);
        slot.appendChild(label);
        slot.dataset.bgId = `${id}-bg`;
        bg.setAttribute('id', slot.dataset.bgId);
      });
      highlightSkinButton(skinIndex);
    }

    function highlightSkinButton(activeIdx){
      const ids = ['btn0','btn1','btn2','btn3','btn4','btn5'];
      ids.forEach((id, idx)=>{
        const slot = document.getElementById(id);
        const bgId = slot.dataset.bgId;
        const bg = document.getElementById(bgId);
        if (!bg) return;
        if (idx === activeIdx){
          bg.setAttribute('material','color:#2b2f3a; opacity:0.98');
          slot.setAttribute('animation__pulse','property=scale; dir=alternate; dur:900; to:1.05 1.05 1.05; loop:true');
        } else {
          bg.setAttribute('material','color:#161a22; opacity:0.95');
          slot.removeAttribute('animation__pulse');
          slot.setAttribute('scale','1 1 1');
        }
      });
    }

    // Build ring of link orbs + labels (stable in VR)
    function buildOrbRing(containerId, items, radius=3.1, y=1.25) {
      const ring = document.getElementById(containerId);
      ring.innerHTML = '';
      const n = items.length;

      for (let i=0;i<n;i++){
        const t = (i/n)*Math.PI*2;
        const x = Math.cos(t)*radius;
        const z = -Math.sin(t)*radius;                         // inward ring (A-Frame forward = -Z)
        const yawDeg = (Math.atan2(0 - x, 0 - z) * 180 / Math.PI); // face centre

        const group = document.createElement('a-entity');
        group.setAttribute('position', `${x} ${y} ${z}`);
        group.setAttribute('rotation', `0 ${yawDeg} 0`);

        // Orb
        const orb = document.createElement('a-entity');
        orb.setAttribute('class','clickable');
        orb.setAttribute('geometry','primitive:sphere; radius:0.25');
        orb.setAttribute('material','color:#ffd700; emissive:#ffd700; emissiveIntensity:0.5; opacity:0.95');
        orb.setAttribute('animation__glow','property=material.emissiveIntensity; dir=alternate; dur=2000; from:0.35; to:1; loop:true');
        orb.setAttribute('event-set__enter','_event:mouseenter; scale:1.3 1.3 1.3');
        orb.setAttribute('event-set__leave','_event:mouseleave; scale:1 1 1');
        orb.addEventListener('click',()=>window.open(items[i].url,'_blank','noopener'));

        // Label
        const label = document.createElement('a-entity');
        label.setAttribute('position','0 0.52 0.01');
        label.setAttribute('billboard-label','');
        label.setAttribute('text',[
          `value:${items[i].title}`,
          'align:center',
          'anchor:center',
          'width:3.0',
          'wrapCount:28',
          'color:#ffd700',
          'side:double'
        ].join('; '));
        label.setAttribute('animation__color','property=components.text.material.color; type=color; from:#ffd700; to:#fff5a8; dir=alternate; dur=1800; loop:true');

        group.appendChild(orb);
        group.appendChild(label);
        ring.appendChild(group);
      }
    }

    // Wire Enter
    document.getElementById('enterBtn').addEventListener('click', ()=>{
      gate.style.display='none';
      document.getElementById('skinPanel').setAttribute('visible', true);
      buildSkinPanel();
      applySkin(skinIndex);
      buildOrbRing('orbRing', links);
      // start look-down watcher (on camera)
      document.querySelector('#camera').setAttribute('lookdown-reset','hold:3000; thresholdY:-0.6');
    });

    // Reset / Refresh click
    document.getElementById('resetOrb').addEventListener('click', ()=>{
      // Soft reset: rebuild ring + reapply current skin
      buildOrbRing('orbRing', links);
      applySkin(skinIndex);
      // If you want a hard refresh instead, uncomment the next line:
      // window.location.reload();
    });
  </script>
</body>
</html>