<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>VLife • Hybrid VR MVP · 360° / HDR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    body { margin:0; background:#000; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif }
    .badge { position:fixed; left:18px; top:18px; padding:10px 14px; border-radius:14px;
             background:rgba(0,0,0,.5); color:#e7e7e7; font-weight:600; letter-spacing:.2px;
             backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); z-index:3; }
    .brand { position:fixed; right:18px; top:18px; display:flex; align-items:center; gap:10px; z-index:3; }
    .brand img{ width:38px; height:38px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,.35) }
    .brand b{ color:#ffe36d; text-shadow:0 1px 10px rgba(255,227,109,.35) }
    .tip { position:fixed; left:18px; right:18px; bottom:18px; padding:14px 16px; border-radius:16px;
           background:rgba(0,0,0,.55); color:#eaeaea; font-size:16px; line-height:1.35;
           backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); z-index:3; }
    .tip b{ color:#ffd95e }
  </style>
</head>
<body>
  <div class="badge">Hybrid VR MVP · 360° / HDR</div>
  <div class="brand">
    <img src="assets/Vlifelogo_1_.png" alt="VLife" />
    <b>VLIFE</b>
  </div>
  <div class="tip">Tip: look at the <b>Skins</b> orb to change backgrounds. Gaze at gold orbs to open previews.</div>

  <a-scene renderer="colorManagement: true; physicallyCorrectLights: true; antialias: true"
           background="color: #000" vr-mode-ui="enabled: true">

    <!-- Camera + fixed reticle (always in front) -->
    <a-entity id="rig" position="0 1.6 0">
      <a-entity id="camera" camera look-controls>
        <a-entity id="reticle" geometry="primitive: ring; radiusInner:0.0125; radiusOuter:0.022"
                  material="color:#ffffff; opacity:0.95; shader:flat"
                  position="0 0 -0.8"></a-entity>
      </a-entity>
    </a-entity>

    <!-- Sky (set by JS from media.json) -->
    <a-sky id="sky" rotation="0 -90 0" src=""></a-sky>

    <!-- Front UI panel -->
    <a-entity id="panel" position="0 1.45 -2.2" rotation="0 0 0" look-at="#camera">
      <!-- card -->
      <a-entity geometry="primitive: plane; width: 1.18; height: 0.78"
                material="shader: standard; color: #111316; roughness:0.9; metalness:0; opacity:0.94"
                position="0 0 0"></a-entity>

      <!-- Title -->
      <a-entity id="title" text="value: Choose Background; align: center; color: #ff9532; width: 2.5"
                position="0 0.30 0.01"></a-entity>

      <!-- Sub-title (active background) -->
      <a-entity id="subtitle" text="value: Using 360 image: …; align: center; color: #71ffa3; width: 2.6"
                position="0 0.18 0.01"></a-entity>

      <!-- Row 1 buttons -->
      <a-entity id="btnRow1" position="0 0.05 0.01">
        <a-entity class="bgbtn" data-index="0" position="-0.35 0 0"></a-entity>
        <a-entity class="bgbtn" data-index="1" position="0.35 0 0"></a-entity>
      </a-entity>

      <!-- Row 2 buttons -->
      <a-entity id="btnRow2" position="0 -0.13 0.01">
        <a-entity class="bgbtn" data-index="2" position="-0.35 0 0"></a-entity>
        <a-entity class="bgbtn" data-index="3" position="0.35 0 0"></a-entity>
      </a-entity>

      <!-- Row 3 buttons -->
      <a-entity id="btnRow3" position="0 -0.31 0.01">
        <a-entity class="bgbtn" data-index="4" position="-0.35 0 0"></a-entity>
        <a-entity class="bgbtn" data-index="5" position="0.35 0 0"></a-entity>
      </a-entity>
    </a-entity>

    <!-- Orb ring container -->
    <a-entity id="orbRing" position="0 1.35 0"></a-entity>

    <!-- Ambient light for gentle lift -->
    <a-entity light="type: ambient; color: #ffffff; intensity: 0.35"></a-entity>

    <!-- Helpers: components for buttons + orbs -->
    <script>
      AFRAME.registerComponent('bg-button', {
        schema:{ label:{default:''}, index:{default:0} },
        init(){
          const plane = document.createElement('a-entity');
          plane.setAttribute('geometry','primitive: plane; width: 0.62; height: 0.12;');
          plane.setAttribute('material','color:#1a1f27; opacity:0.92; shader:standard; roughness:0.9; metalness:0;');
          plane.setAttribute('class','clickable');
          this.el.appendChild(plane);

          const txt = document.createElement('a-entity');
          txt.setAttribute('text',`value:${this.data.label}; align:center; color:#d7e6ff; width:1.8`);
          txt.setAttribute('position','0 0 0.01');
          this.el.appendChild(txt);

          // subtle hover with gaze
          this.el.addEventListener('mouseenter',()=> plane.setAttribute('material','color:#243042; opacity:0.98; shader:standard; roughness:0.85;'));
          this.el.addEventListener('mouseleave',()=> plane.setAttribute('material','color:#1a1f27; opacity:0.92; shader:standard; roughness:0.9;'));

          // click -> update background
          this.el.addEventListener('click', () => {
            const i = this.data.index;
            window.setBackground(i);
          });
        }
      });

      // Fancy orb (core + glow + soft point-light) + label that always faces camera
      AFRAME.registerComponent('gold-orb', {
        schema:{ label:{default:''}, url:{default:''} },
        init(){
          // soft light
          const lamp = document.createElement('a-entity');
          lamp.setAttribute('light','type: point; intensity: 0.22; distance: 3; color: #ffd766');
          lamp.setAttribute('position','0 0 0.2');
          this.el.appendChild(lamp);

          // glow sphere
          const glow = document.createElement('a-sphere');
          glow.setAttribute('radius','0.18');
          glow.setAttribute('material','color:#ffd657; emissive:#eebc40; emissiveIntensity:1.2; roughness:0.6; metalness:0.1;');
          this.el.appendChild(glow);

          // halo (slightly bigger, transparent)
          const halo = document.createElement('a-sphere');
          halo.setAttribute('radius','0.24');
          halo.setAttribute('material','color:#ffdf7a; opacity:0.25; transparent:true; side:double');
          this.el.appendChild(halo);

          // label plate
          const plate = document.createElement('a-entity');
          plate.setAttribute('geometry','primitive: plane; width: 0.9; height: 0.12;');
          plate.setAttribute('material','color:#2b2b2b; opacity:0.78');
          plate.setAttribute('position','0 0.34 0');
          plate.setAttribute('look-at','#camera');
          this.el.appendChild(plate);

          const txt = document.createElement('a-entity');
          txt.setAttribute('text',`value:${this.data.label}; align:center; color:#ffcf5a; width:2.2`);
          txt.setAttribute('position','0 0 0.01');
          plate.appendChild(txt);

          // gaze to open preview page
          this.el.setAttribute('class','clickable');
          this.el.addEventListener('click', () => {
            if(this.data.url){ window.open(this.data.url, '_blank'); }
          });
        }
      });

      // --- Data + layout ---
      const PANEL_Z = -2.2;     // front card depth
      const ORB_RADIUS = 3.8;    // circle radius
      const ORB_Y = 1.25;        // height
      const ORB_COUNT = 6;       // how many around the ring
      const NO_ARC = 50;         // degrees blocked in front of the panel (keeps clear)
      let media = null, activeIndex = 0;

      async function loadMedia(){
        const res = await fetch('assets/media.json?_=' + Date.now());
        media = await res.json();
        if (!media || !media.backgrounds || media.backgrounds.length === 0) return;

        // Populate buttons
        const btns = Array.from(document.querySelectorAll('.bgbtn'));
        btns.forEach((b,i)=>{
          const item = media.backgrounds[i];
          if(!item) { b.setAttribute('visible','false'); return; }
          b.setAttribute('bg-button',`label:${item.name.replaceAll(':','-')}; index:${i}`);
          b.setAttribute('visible','true');
        });

        // First background
        setBackground(0);

        // Build orbs (6 evenly spread, but skipping the forward arc)
        const orbRing = document.getElementById('orbRing');
        orbRing.innerHTML = '';
        const links = [
          {label:'YouTube VR Channel', url:'https://m.youtube.com/channel/UCzuqhhs6NWbgTzMuM09WKDQ'},
          {label:'360Cities',         url:'https://www.360cities.net/'},
          {label:'Meta Quest TV',     url:'https://www.meta.com/quest/tv/'},
          {label:'Skins',             url:''}, // will open panel, not a link
          {label:'Help',              url:''},
          {label:'More 360',          url:'https://www.airpano.com/'}
        ];

        let placed = 0, angle = -140; // start from far left
        while (placed < ORB_COUNT && angle <= 140){
          // Skip forward arc around 0°
          if (Math.abs(angle) < NO_ARC){ angle += 20; continue; }
          const rad = angle * Math.PI / 180;
          const x = Math.sin(rad) * ORB_RADIUS;
          const z = -Math.cos(rad) * ORB_RADIUS; // negative z = in front
          const orb = document.createElement('a-entity');
          const link = links[placed] || {label:`Link ${placed+1}`, url:''};
          orb.setAttribute('position', `${x} ${ORB_Y} ${z}`);
          if (link.label.toLowerCase()==='skins'){
            orb.setAttribute('gold-orb', `label:${link.label}; url:`);
            orb.addEventListener('click', () => showPanel(true));
          } else {
            orb.setAttribute('gold-orb', `label:${link.label}; url:${link.url}`);
          }
          orbRing.appendChild(orb);
          placed++; angle += 48; // spread nicely
        }
      }

      window.setBackground = function(index){
        if (!media || !media.backgrounds[index]) return;
        activeIndex = index;
        const item = media.backgrounds[index];
        const sky = document.getElementById('sky');
        sky.setAttribute('src', item.img);
        document.getElementById('subtitle')
          .setAttribute('text', `value: Using 360 image: ${item.name}; align:center; color:#71ffa3; width:2.6`);
        // keep the panel visible after change
        showPanel(true);
      }

      function showPanel(vis){
        const p = document.getElementById('panel');
        p.setAttribute('visible', vis ? 'true':'true'); // always visible now
      }

      document.addEventListener('DOMContentLoaded', loadMedia);
    </script>
  </a-scene>
</body>
</html>