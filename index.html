<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Vlife – Hybrid VR Experience</title>
  <link rel="icon" href="assets/Vlifelogo_1_.png"/>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-event-set-component@5.0.1/dist/aframe-event-set-component.min.js"></script>
  <style>
    :root{--gold:#ffd700;--bg:#0b0d13;--text:#e7e7ea}
    html,body{margin:0;height:100%;background:#000;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}

    .topright{position:fixed;right:16px;top:12px;display:flex;align-items:center;gap:10px;z-index:9}
    .brand{color:var(--gold);font-weight:800;letter-spacing:.6px;text-shadow:0 0 12px rgba(255,215,0,.4)}
    .badge{position:fixed;top:12px;left:12px;color:#bdbdc7;font-size:12px;background:rgba(0,0,0,.45);padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.1);z-index:9}

    /* Entry */
    .gate{position:fixed;inset:0;display:grid;place-items:center;background:radial-gradient(1200px 600px at 50% 100%,rgba(255,215,0,.06),#000 70%);z-index:10}
    .gate-inner{max-width:720px;margin:0 16px;background:rgba(12,12,18,.72);padding:22px;border:1px solid rgba(255,255,255,.15);border-radius:16px;text-align:center;color:var(--text);box-shadow:0 16px 72px rgba(0,0,0,.6)}
    .btn{background:linear-gradient(180deg,#ffe58a,#e7c138);color:#2b2500;border:none;border-radius:12px;padding:10px 18px;font-weight:700;cursor:pointer}

    /* Panel + modal */
    .skinsHud{position:fixed;left:50%;bottom:68px;transform:translateX(-50%);z-index:8}
    .chip{background:rgba(0,0,0,.55);backdrop-filter:blur(8px);color:#e8e8ef;border:1px solid rgba(255,255,255,.14);padding:6px 10px;border-radius:999px;font-size:13px}

    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:11}
    .panel{width:min(920px,94vw);background:rgba(16,18,24,.96);border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:14px 14px 12px;color:#e8eaee;box-shadow:0 18px 90px rgba(0,0,0,.6)}
    .panel .head{display:flex;align-items:center;gap:10px;margin-bottom:8px}
    .panel h3{margin:0;font-size:18px;color:#ffd76a;flex:1}
    .row{display:flex;gap:10px;justify-content:flex-end;margin-top:10px}
    .b{padding:9px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.14);background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.04));color:#e7e7ea;font-weight:600;cursor:pointer}
    .b.primary{background:linear-gradient(180deg,#ffe58a,#e7c138);color:#251e00;border:none}

    .frameWrap{position:relative;background:#0e1117;border:1px solid rgba(255,255,255,.08);border-radius:12px;height:min(56vw,420px)}
    .frame{position:absolute;inset:0;border:0;width:100%;height:100%;border-radius:12px;background:#0e1117}
    .frameFallback{position:absolute;inset:0;display:none;align-items:center;justify-content:center;color:#cfd3da}
    .small{font-size:12px;color:#9aa1ad}

    /* For orb labels */
    .pill{background:rgba(12,14,18,.72);border:1px solid rgba(255,255,255,.12);padding:4px 8px;border-radius:10px}
  </style>
</head>
<body>
  <div class="topright">
    <img src="assets/Vlifelogo_1_.png" alt="V LIFE" style="width:32px;height:32px;border-radius:8px;box-shadow:0 0 0 1px rgba(255,255,255,.25) inset"/>
    <div class="brand">VLIFE</div>
  </div>
  <div class="badge">Hybrid VR MVP · 360° / HDR</div>

  <!-- Entry -->
  <div class="gate" id="gate">
    <div class="gate-inner">
      <img src="assets/Vlifelogo_1_.png" alt="V LIFE" style="width:min(360px,70vw);display:block;margin:0 auto 12px"/>
      <h1>Enter Vlife</h1>
      <p>Immersive 360° exploration. Tap “Skins” to switch backgrounds.</p>
      <button class="btn" id="enterBtn" type="button">Enter Experience</button>
      <p style="margin-top:10px;font-size:12px;opacity:.8;">Gaze/click gold orbs to preview links in-app.</p>
    </div>
  </div>

  <!-- In-app web preview -->
  <div class="backdrop" id="previewBackdrop" role="dialog" aria-modal="true">
    <div class="panel">
      <div class="head">
        <h3 id="pvTitle">Preview</h3>
        <span id="pvHost" class="small"></span>
      </div>
      <div class="frameWrap">
        <iframe id="pvFrame" class="frame"
          allow="autoplay; fullscreen; xr-spatial-tracking; gyroscope; accelerometer; vr; encrypted-media"
          referrerpolicy="no-referrer-when-downgrade" sandbox="allow-scripts allow-same-origin allow-popups allow-forms allow-presentation">
        </iframe>
        <div id="pvFallback" class="frameFallback">
          <div style="text-align:center;max-width:90%">
            <div style="margin-bottom:6px;">This site blocks embedding.</div>
            <div class="small">Tap “Open in new tab”.</div>
          </div>
        </div>
      </div>
      <div class="row">
        <button class="b" id="pvClose">Close</button>
        <button class="b primary" id="pvOpen">Open in new tab</button>
      </div>
    </div>
  </div>

  <div class="skinsHud"><span class="chip">Tip: use the “Skins” orb to change backgrounds</span></div>

  <a-scene id="scene" renderer="antialias:true physicallyCorrectLights:true" background="color:#000">
    <a-assets timeout="30000"></a-assets>

    <a-entity id="rig">
      <a-entity id="camera" camera look-controls wasd-controls-enabled="false" position="0 1.6 0"
        cursor="fuse:true; fuseTimeout:900; rayOrigin:entity"
        raycaster="objects: .clickable; far: 100; interval: 0">
        <a-entity position="0 0 -1" geometry="primitive:ring; radiusInner:0.01; radiusOuter:0.015"
          material="shader:flat; opacity:0.9"></a-entity>

        <!-- Skins mini-orb near reticle -->
        <a-entity id="skinsToggle" position="-0.75 -0.15 -0.85" class="clickable" visible="false">
          <a-entity geometry="primitive:sphere; radius:0.12"
            material="color:#ffd700; emissive:#ffd700; emissiveIntensity:0.5; opacity:0.95"></a-entity>
          <a-entity position="0 0.28 0.02"
            text="value:Skins; align:center; width:1.4; color:#ffd700; shader:msdf; side:front; font:https://cdn.aframe.io/fonts/Roboto-msdf.json"></a-entity>
        </a-entity>
      </a-entity>
    </a-entity>

    <!-- crossfade skies -->
    <a-sky id="skyA" color="#0b0d13" visible="true"  material="opacity:1; transparent:true"></a-sky>
    <a-sky id="skyB" color="#0b0d13" visible="false" material="opacity:0; transparent:true"></a-sky>

    <!-- Skins panel -->
    <a-entity id="skinPanel" position="0 1.5 -3.6" scale="0.95 0.95 0.95" visible="false">
      <a-entity geometry="primitive:plane; width:2.2; height:1.35" material="color:#10131a; opacity:0.96"></a-entity>
      <a-entity position="0 0.63 0.03"
        text="value:Choose Background; align:center; width:2.0; wrapCount:24; color:#ffd700; shader:msdf; side:front; font:https://cdn.aframe.io/fonts/Roboto-msdf.json"></a-entity>
      <a-entity id="skinStatus" position="0 0.48 0.03"
        text="value:; align:center; width:1.95; wrapCount:26; color:#a8f0b0; shader:msdf; side:front; font:https://cdn.aframe.io/fonts/Roboto-msdf.json"></a-entity>

      <a-entity id="btn0" position="-0.74  0.07 0.03"></a-entity>
      <a-entity id="btn1" position=" 0.00  0.07 0.03"></a-entity>
      <a-entity id="btn2" position=" 0.74  0.07 0.03"></a-entity>
      <a-entity id="btn3" position="-0.74 -0.45 0.03"></a-entity>
      <a-entity id="btn4" position=" 0.00 -0.45 0.03"></a-entity>
      <a-entity id="btn5" position=" 0.74 -0.45 0.03"></a-entity>
    </a-entity>

    <!-- link orbs ring -->
    <a-entity id="orbRing"></a-entity>

    <a-entity id="keyLight" light="type:point; intensity:0.9; distance:12" position="0 3 0"></a-entity>
    <a-entity id="ambLight" light="type:ambient; intensity:0.45; color:#ffffff"></a-entity>
  </a-scene>

  <script>
    const $ = s => document.querySelector(s);
    const sceneEl = $('#scene');

    // Preview modal elements
    const pvBackdrop = $('#previewBackdrop');
    const pvTitle    = $('#pvTitle');
    const pvHost     = $('#pvHost');
    const pvFrame    = $('#pvFrame');
    const pvFallback = $('#pvFallback');
    const pvClose    = $('#pvClose');
    const pvOpen     = $('#pvOpen');
    let pvURL = null, pvTimer = null;

    function hostFromUrl(u){ try{ return new URL(u).host; }catch{ return ''; } }

    function showPreview(title,url){
      pvURL = url;
      pvTitle.textContent = title;
      pvHost.textContent  = hostFromUrl(url);
      pvFallback.style.display = 'none';
      pvFrame.src = 'about:blank';
      pvBackdrop.style.display = 'flex';

      // try to load – if blocked, show fallback after timeout
      pvTimer = setTimeout(()=>{ pvFallback.style.display='flex'; }, 3500);
      pvFrame.onload = ()=>{ clearTimeout(pvTimer); };
      pvFrame.src = url;
    }
    function hidePreview(){
      pvBackdrop.style.display = 'none';
      pvFrame.src = 'about:blank';
      pvURL = null;
      clearTimeout(pvTimer);
    }
    pvClose.onclick = hidePreview;
    pvOpen.onclick  = ()=>{ if(pvURL) window.open(pvURL,'_blank','noopener'); };

    // renderer
    sceneEl.addEventListener('render-target-loaded', ()=>{
      const r = sceneEl.renderer; if (!r) return;
      r.outputEncoding = THREE.sRGBEncoding;
      r.toneMapping = THREE.ACESFilmicToneMapping;
      r.toneMappingExposure = 1.0;
    });

    async function getJSON(url){ try{ const r=await fetch(url,{cache:'no-store'}); if(!r.ok) throw 0; return await r.json(); }catch(e){ return null; } }
    let SKINS = [];

    // External links
    const LINKS = [
      {title:'YouTube VR Channel',  url:'https://m.youtube.com/channel/UCzuqhhs6NWbgTzMuM09WKDQ', desc:'Official YouTube VR/360 hub.'},
      {title:'360Cities',           url:'https://www.360cities.net/', desc:'Explore community 360° panoramas.'},
      {title:'Meta Quest TV',       url:'https://www.meta.com/quest/tv/', desc:'Curated VR video for Quest.'},
      {title:'AirPano',             url:'https://www.airpano.com/', desc:'High-quality 360° photo tours.'},
      {title:'Vimeo 360',           url:'https://vimeo.com/channels/360videos', desc:'Artistic 360° videos on Vimeo.'},
      {title:'YouTube 360 Playlist',url:'https://www.youtube.com/playlist?list=PLU8wpH_LfhmtcxKMb1s46HUz8AVnLiY3O', desc:'Starter 360° playlist.'}
    ];

    // High-contrast orbs
    function makeOrb(title,url,desc){
      const g=document.createElement('a-entity');

      const halo=document.createElement('a-entity');
      halo.setAttribute('geometry','primitive:plane; width:1.15; height:1.15');
      halo.setAttribute('material','color:#ffd700; opacity:0.22; blending:additive; transparent:true; side:double');
      halo.setAttribute('look-at','#camera');
      halo.setAttribute('animation__pulse','property=material.opacity; to:0.38; dir=alternate; dur:1200; easing=easeInOutSine; loop:true');

      const orb=document.createElement('a-entity');
      orb.classList.add('clickable');
      orb.setAttribute('geometry','primitive:sphere; radius:0.26');
      orb.setAttribute('material','color:#ffd700; metalness:0.55; roughness:0.2; emissive:#e7c23a; emissiveIntensity:0.75; opacity:0.98');
      orb.setAttribute('animation__breath','property=scale; to:1.09 1.09 1.09; dir=alternate; dur:1500; easing=easeInOutSine; loop:true');

      const ring=document.createElement('a-entity');
      ring.setAttribute('geometry','primitive:torus; radius:0.36; radiusTubular:0.01; segmentsTubular:40');
      ring.setAttribute('material','color:#fff1a8; emissive:#ffd700; emissiveIntensity:0.7; metalness:0.1; roughness:0.2');

      const labelBg=document.createElement('a-entity');
      labelBg.setAttribute('geometry','primitive:plane; width:1.8; height:0.33');
      labelBg.setAttribute('material','color:#0e1218; opacity:0.8; transparent:true');
      labelBg.setAttribute('position','0 0.55 0.03');

      const label=document.createElement('a-entity');
      label.setAttribute('position','0 0.55 0.04');
      label.setAttribute('text','value:'+title+'; align:center; width:2.0; wrapCount:24; color:#ffd700; shader:msdf; side:front; font:https://cdn.aframe.io/fonts/Roboto-msdf.json');

      const open = ()=>showPreview(title,url,desc);
      ['click','pointerup','mouseup','touchend'].forEach(ev=>{
        orb.addEventListener(ev,open,{passive:true});
        label.addEventListener(ev,open,{passive:true});
        labelBg.addEventListener(ev,open,{passive:true});
        halo.addEventListener(ev,open,{passive:true});
      });

      g.appendChild(halo); g.appendChild(orb); g.appendChild(ring);
      g.appendChild(labelBg); g.appendChild(label);
      return g;
    }

    function buildOrbRing(containerId, items, radius = 5.4, y = 1.3) {
      const ring = document.getElementById(containerId);
      ring.innerHTML = '';
      const n = items.length; if (!n) return;

      const panelYaw = $('#skinPanel').object3D.rotation.y;
      const FRONT_GAP = THREE.MathUtils.degToRad(70);
      const EDGE = THREE.MathUtils.degToRad(4);
      const TAU = Math.PI * 2;

      const usable = TAU - 2*FRONT_GAP - 2*EDGE;
      const step = usable / n;
      const start = panelYaw + FRONT_GAP + EDGE + step/2;

      for (let i=0;i<n;i++){
        const a = start + i*step;
        const x = Math.cos(a)*radius;
        const z = -Math.sin(a)*radius;
        const yaw = Math.atan2(-x,-z)*180/Math.PI;

        const g = makeOrb(items[i].title, items[i].url, items[i].desc);
        g.setAttribute('position',`${x} ${y} ${z}`);
        g.setAttribute('rotation',`0 ${yaw} 0`);
        ring.appendChild(g);
      }
    }

    function applyLights(s){
      if (!s) return;
      $('#ambLight').setAttribute('light', `type:ambient; intensity:${s.ambInt ?? 0.45}; color:${s.ambient || '#ffffff'}`);
      $('#keyLight').setAttribute('light', `type:point; intensity:${s.keyInt ?? 0.9}; distance:12; color:#ffffff`);
    }

    let usingA = true;
    async function setImageSky(src, name, skinObj){
      const skyA=$('#skyA'), skyB=$('#skyB'); applyLights(skinObj);
      const front = usingA ? skyB : skyA; const back = usingA ? skyA : skyB;
      if (src) { front.removeAttribute('color'); front.setAttribute('src', src); front.setAttribute('rotation','0 -90 0'); }
      else { front.removeAttribute('src'); front.setAttribute('color', skinObj?.fallback || '#10131a'); }
      front.setAttribute('visible',true);
      const start=performance.now(), ms=900;
      const fade=(t)=>{ const k=Math.min(1,(t-start)/ms); front.setAttribute('material',`opacity:${k}; transparent:true`); back.setAttribute('material',`opacity:${1-k}; transparent:true`); if(k<1) requestAnimationFrame(fade); else { back.setAttribute('visible',false); usingA=!usingA; } };
      requestAnimationFrame(fade);
      $('#skinStatus').setAttribute('text',`value:Using 360 image: ${name}; align:center; width:1.95; wrapCount:26; color:#a8f0b0; shader:msdf; side:front; font:https://cdn.aframe.io/fonts/Roboto-msdf.json`);
      setTimeout(()=>{ const mesh=front.getObject3D('mesh'); const r=sceneEl.renderer; if(mesh&&mesh.material&&mesh.material.map&&r){ mesh.material.map.anisotropy=r.capabilities.getMaxAnisotropy(); mesh.material.map.needsUpdate=true; } }, 250);
    }

    function buildSkinPanel(){
      const ids=['btn0','btn1','btn2','btn3','btn4','btn5'];
      ids.forEach((id,idx)=>{
        const slot=document.getElementById(id); slot.innerHTML='';
        if(!SKINS[idx]){ slot.setAttribute('visible', false); return; }
        const s=SKINS[idx];

        const card=document.createElement('a-entity');
        card.setAttribute('geometry','primitive:plane; width:0.78; height:0.24');
        card.setAttribute('material','color:#161a22; opacity:0.96');
        card.classList.add('clickable');
        const choose=()=>{ $('#skinStatus').setAttribute('text',`value:Loading: ${s.name} …; align:center; width:1.95; color:#a8f0b0; shader:msdf; side:front; font:https://cdn.aframe.io/fonts/Roboto-msdf.json`); setImageSky(s.img, s.name, s); };
        ['click','pointerdown','touchend'].forEach(ev=>card.addEventListener(ev,choose,{passive:true}));

        const label=document.createElement('a-entity');
        label.setAttribute('position','0 0 0.03');
        label.setAttribute('text',`value:${s.name}; align:center; width:0.74; wrapCount:14; color:#dfe3ea; shader:msdf; side:front; font:https://cdn.aframe.io/fonts/Roboto-msdf.json`);
        ['click','pointerdown','touchend'].forEach(ev=>label.addEventListener(ev,choose,{passive:true}));

        slot.appendChild(card); slot.appendChild(label);
      });
    }

    function tuneForMobile(){
      if (window.innerWidth < 760){
        const p = $('#skinPanel');
        p.setAttribute('position','0 1.48 -3.9');
        p.setAttribute('scale','0.88 0.88 0.88');
      }
    }

    async function init(){
      tuneForMobile();
      const media = await getJSON('assets/media.json');
      SKINS = (media && (media.backgrounds || media.skins)) || [];
      buildSkinPanel();
      if (SKINS[0]) setImageSky(SKINS[0].img, SKINS[0].name, SKINS[0]);

      $('#skinsToggle').setAttribute('visible', true);
      $('#skinPanel').setAttribute('visible', true);

      buildOrbRing('orbRing', LINKS, 5.4, 1.3);
    }

    $('#enterBtn').addEventListener('click', ()=>{ $('#gate').style.display='none'; init(); });
    $('#skinsToggle').addEventListener('click', ()=>{ const p=$('#skinPanel'); p.setAttribute('visible', !p.getAttribute('visible')); });
  </script>
</body>
</html>